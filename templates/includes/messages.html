<!-- messages.html -->

<!-- Floating AJAX messages container -->
<div id="ajax-messages" class="position-fixed top-0 start-50 translate-middle-x mt-3" style="z-index: 1055;"></div>

<!-- Normal Django messages (page load) -->
{% if messages %}
<div class="container mt-4">
    {% for message in messages %}
    <div class="alert 
        {% if message.tags == 'error' %} alert-danger
        {% elif message.tags == 'success' %} alert-success
        {% elif message.tags == 'warning' %} alert-warning
        {% elif message.tags == 'info' %} alert-info
        {% else %} alert-secondary
        {% endif %}
        alert-dismissible fade show shadow-sm d-flex align-items-center"
        role="alert">

        <!-- Icon -->
        <div class="me-2 fs-5">
            {% if message.tags == 'success' %} ‚úÖ
            {% elif message.tags == 'error' %} ‚ùå
            {% elif message.tags == 'warning' %} ‚ö†Ô∏è
            {% elif message.tags == 'info' %} ‚ÑπÔ∏è
            {% else %} üîî
            {% endif %}
        </div>

        <!-- Message Text -->
        <div class="flex-grow-1 fw-semibold">
            {{ message }}
        </div>

        <!-- Close Button -->
        <button type="button" class="btn-close ms-3" data-bs-dismiss="alert" aria-label="Close"></button>

    </div>
    {% endfor %}
</div>
{% endif %}

<!-- JS function to display AJAX messages dynamically -->
<script>
function showAjaxMessages(messages) {
    const container = $('#ajax-messages');

    messages.forEach(msg => {
        let alertClass = "alert-secondary";
        let icon = "üîî";

        switch(msg.level) {
            case 'success': alertClass = "alert-success"; icon = "‚úÖ"; break;
            case 'error':   alertClass = "alert-danger"; icon = "‚ùå"; break;
            case 'warning': alertClass = "alert-warning"; icon = "‚ö†Ô∏è"; break;
            case 'info':    alertClass = "alert-info"; icon = "‚ÑπÔ∏è"; break;
        }

        // Create alert element
        const alertHtml = $(`
            <div class="alert ${alertClass} alert-dismissible fade show shadow-sm d-flex align-items-center" role="alert">
                <div class="me-2 fs-5">${icon}</div>
                <div class="flex-grow-1 fw-semibold">${msg.text}</div>
                <button type="button" class="btn-close ms-3" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        `);

        container.append(alertHtml);

        // Auto-close using Bootstrap 5 Alert API
        const bsAlert = new bootstrap.Alert(alertHtml[0]);
        setTimeout(() => bsAlert.close(), 3000);
    });
}

// Auto-close page-load messages after 3 seconds
document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('.alert').forEach(function(alertElem) {
        const bsAlert = new bootstrap.Alert(alertElem);
        setTimeout(() => bsAlert.close(), 3000);
    });
});
</script>